
@{
    ViewData["Title"] = "ComisionTecnica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-header">
    <h1>
        Equipos
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            Esta sección es para alta, baja y actulización de un equipos, adicional va se deben de agregar los jugadores del equipo.
        </small>
    </h1>
</div><!-- /.page-header -->

<div class="row">
    <div class="col-xs-12">
        <!-- PAGE CONTENT BEGINS -->
        <div class="row">
            <h4>
                <i class="ace-icon fas fa-hand-point-right icon-animated-hand-pointer blue"></i>
                <a href="#" role="button" class="blue" data-target="#modal-table" data-toggle="modal" data-backdrop="static"> Agregar Equipo </a>
            </h4>
            <div class="hr hr-18 dotted hr-double"></div>
            <div class="col-xs-12">
                <table id="equipos-table" class="table  table-bordered table-hover">
                    <thead>
                        <tr>
                            <th class="detail-col">Detalle</th>
                            <th>Liga</th>
                            <th>Categoria</th>
                            <th>Nombre</th>
                            <th class="hidden-480">Estado</th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                    </tbody>
                </table>
            </div><!-- /.span -->
        </div><!-- /.row -->

        <div id="modal-table" class="modal fade" role="dialog" tabindex="-1" aria-labelledby="modalRegistro" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <div>
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                <span class="red">&times;</span>
                            </button>
                            <h4>Registro del un equipo</h4>
                        </div>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="widget-box">
                                    <div class="widget-header">
                                        <h4 class="widget-title">Datos del equipo</h4>
                                    </div>

                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <div class="row">
                                                <form class="form-horizontal" role="form">
                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1"> Liga </label>

                                                        <div class="col-sm-9">
                                                            <select class="form-control" id="form-field-select-1">
                                                                <option value="">Seleccione una Liga</option>
                                                                <option value="1">Liga del sur</option>
                                                                <option value="2">Liga del Norte</option>
                                                                <option value="3">Liga del centro</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Categoría </label>

                                                        <div class="col-sm-9">
                                                            <select class="form-control" id="form-field-select-1">
                                                                <option value="2">Categoria B</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Serie </label>

                                                        <div class="col-sm-9">
                                                            <select class="form-control" id="form-field-select-1">
                                                                <option value="2">Serie 1</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Dirigente </label>

                                                        <div class="col-sm-9">
                                                            <select class="form-control" id="form-field-select-1">
                                                                <option value="1">Omar</option>
                                                                <option value="2">Santiago</option>
                                                                <option value="3">Francisco</option>
                                                                <option value="4">Roberto</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="space-4"></div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Nombre </label>

                                                        <div class="col-sm-9">
                                                            <input type="text" id="form-field-1-1" placeholder="Nombre" class="form-control">
                                                        </div>
                                                    </div>

                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="col-lg-6">
                                <div class="widget-box">
                                    <div class="widget-header">
                                        <h4 class="widget-title">Foto del equipo</h4>
                                    </div>

                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <div class="row">
                                                <form class="form-horizontal" role="form">
                                                    <div class="form-group">
                                                        <div class="col-xs-12">
                                                            <input multiple="" type="file" id="id-input-file-3" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Fundación </label>

                                                        <div class="col-sm-9">
                                                            <div class="input-group">
                                                                <input class="form-control date-picker" id="id-date-picker-1" type="text" data-date-format="dd-mm-yyyy">
                                                                <span class="input-group-addon">
                                                                    <i class="fa fa-calendar bigger-110"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-3 control-label no-padding-right" for="form-field-1-1"> Color </label>

                                                        <div class="col-sm-9">
                                                            <input type="text" id="form-field-1-1" placeholder="Color" class="form-control">
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="widget-box">
                                    <div class="widget-header">
                                        <h4 class="widget-title">Jugadores del equipo</h4>
                                    </div>

                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <div class="row">
                                                <button class="btn btn-sm btn-primary pull-left" data-dismiss="modal">
                                                    <i class="ace-icon fas fa-check"></i>
                                                    Agregar Jugador
                                                </button>
                                                <div class="class=" col-xs-12">
                                                    <table id="registro-table" class="table table-bordered table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>Estado Civil</th>
                                                                <th>Instruccion</th>
                                                                <th>Profesión</th>
                                                                <th>Provincia</th>
                                                                <th>Parroquia</th>
                                                                <th>Cedula</th>
                                                                <th>Nombre</th>
                                                                <th>Apellido</th>
                                                                <th>Fecha Nacimiento</th>
                                                                <th>Carnet</th>
                                                                <th>FechaA filiacion</th>
                                                                <th>Estado</th>
                                                                <th>foto</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>Soltero</td>
                                                                <td>Elemental</td>
                                                                <td>Soldador</td>
                                                                <td>Carcha</td>
                                                                <td>Parroquia 1</td>
                                                                <td>4234324-2</td>
                                                                <td>Ricardo</td>
                                                                <td>Apellido 1</td>
                                                                <td>07/06/1982</td>
                                                                <td>15</td>
                                                                <td>03/03/2020</td>
                                                                <td class="hidden-480">
                                                                    <span class="label label-success arrowed-right arrowed-in">ACTIVO</span>
                                                                </td>
                                                                <td>foto</td>
                                                                <td>
                                                                    <div class="hidden-sm hidden-xs btn-group">
                                                                        <button class="btn btn-xs btn-success">
                                                                            <i class="ace-icon fa fa-check bigger-120"></i>
                                                                        </button>

                                                                        <button class="btn btn-xs btn-info">
                                                                            <i class="ace-icon fas fa-pen-alt bigger-120"></i>
                                                                        </button>

                                                                        <button class="btn btn-xs btn-danger">
                                                                            <i class="ace-icon fa fa-trash-alt bigger-120"></i>
                                                                        </button>

                                                                        <button class="btn btn-xs btn-warning">
                                                                            <i class="ace-icon fa fa-flag bigger-120"></i>
                                                                        </button>
                                                                    </div>

                                                                    <div class="hidden-md hidden-lg">
                                                                        <div class="inline pos-rel">
                                                                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown" data-position="auto">
                                                                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                                                                            </button>

                                                                            <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                                                                <li>
                                                                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                                                                        <span class="blue">
                                                                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                                                                        </span>
                                                                                    </a>
                                                                                </li>

                                                                                <li>
                                                                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                                                                        <span class="green">
                                                                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                                                                        </span>
                                                                                    </a>
                                                                                </li>

                                                                                <li>
                                                                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                                                                        <span class="red">
                                                                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                                                                        </span>
                                                                                    </a>
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer no-margin-top">
                            <button class="btn btn-sm btn-danger pull-left" data-dismiss="modal">
                                <i class="ace-icon fa fa-times"></i>
                                Cerrar
                            </button>
                            <button class="btn btn-sm btn-success pull-right" data-dismiss="modal">
                                <i class="ace-icon fas fa-check"></i>
                                Guardar
                            </button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div>
        </div>
        <template id="equipoRow">
            <tr>
                <td class="center">
                    <div class="action-buttons">
                        <a href="#" class="green bigger-140 show-details-btn" title="Muestra el detalle del equipo">
                            <i class="ace-icon fa fa-angle-double-down"></i>
                            <span class="sr-only">Detalle</span>
                        </a>
                    </div>
                </td>

                <td id="ligaRow"></td>
                <td id="CategoriaRow"></td>
                <td id="Nombre"></td>
                <td class="hidden-480">
                    <span id="estado" class="label"></span>
                </td>

                <td>
                    <div class="hidden-sm hidden-xs btn-group">
                        <button class="btn btn-xs btn-success">
                            <i class="ace-icon fa fa-check bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-info">
                            <i class="ace-icon fas fa-pen-alt bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-danger">
                            <i class="ace-icon fa fa-trash-alt bigger-120"></i>
                        </button>

                        <button class="btn btn-xs btn-warning">
                            <i class="ace-icon fa fa-flag bigger-120"></i>
                        </button>
                    </div>

                    <div class="hidden-md hidden-lg">
                        <div class="inline pos-rel">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown" data-position="auto">
                                <i class="ace-icon fa fa-cog icon-only bigger-110"></i>
                            </button>

                            <ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
                                <li>
                                    <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                        <span class="blue">
                                            <i class="ace-icon fa fa-search-plus bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                        <span class="green">
                                            <i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                        <span class="red">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="detail-row">
                <td colspan="8">
                    <div class="table-detail">
                        <div class="row">
                            <div class="col-xs-12 col-sm-2">
                                <div class="text-center">
                                    <img height="150" class="thumbnail inline no-margin-bottom" alt="Equipos" src="~/images/Portada/galeria3.jpeg" />
                                    <br />
                                    <div class="width-80 label label-info label-xlg arrowed-in arrowed-in-right">
                                        <div class="inline position-relative">
                                            <a class="user-title-label" href="#">
                                                <span class="white">KENNEDY NUEVA GENERACION</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-7">
                                <div class="space visible-xs"></div>

                                <div class="profile-user-info profile-user-info-striped">
                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> Equipo </div>

                                        <div class="profile-info-value">
                                            <span>KENNEDY NUEVA GENERACION</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> Liga </div>

                                        <div class="profile-info-value">
                                            <i class="fa fa-map-marker light-orange bigger-110"></i>
                                            <span>Categoria A</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> Dirigente </div>

                                        <div class="profile-info-value">
                                            <span>RAMIRO VALDEZ</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> Fundación </div>

                                        <div class="profile-info-value">
                                            <span>2010/06/20</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> Color </div>

                                        <div class="profile-info-value">
                                            <span>AZUL</span>
                                        </div>
                                    </div>

                                    <div class="profile-info-row">
                                        <div class="profile-info-name"> # Jugadores </div>

                                        <div class="profile-info-value">
                                            <span>20</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </template>
        <!-- PAGE CONTENT ENDS -->
    </div><!-- /.col -->
</div><!-- /.row -->
@section Scripts {
    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        // Variable Globales
        var NombreArchivoFoto = '';

        jQuery(function ($) {

            obtenerEquiposVista();

            // Agregregamos el control para cargar la foto
            $('#id-input-file-3').ace_file_input({ style: 'well', btn_choose: 'Subir foto', btn_change: 'Cambiar', droppable: true, onchange: null, thumbnail: false, allowExt: ['jpg', 'jpeg', 'png', 'bmp'], allowMime: ['image/jpg', 'image/jpeg', 'image/png', 'image/bmp'], before_change: CargarFoto, before_remove: ElimarFoto });

            $('.show-details-btn').on('click', function (e) {
                e.preventDefault();
                $(this).closest('tr').next().toggleClass('open');
                $(this).find(ace.vars['.icon']).toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');
            });

            $('#registro-table').css({ 'width': '2000px', 'max-width': 'none' }).wrap('<div style="width: 100%;" />').parent().ace_scroll(
                {
                    horizontal: true,
                    styleClass: 'scroll-top scroll-dark scroll-visible',//show the scrollbars on top(default is bottom)
                    size: 2000,
                    mouseWheelLock: true
                }
            ).css('padding-top', '12px');
        });

        function obtenerEquiposVista(consulta) {

            $.get("../Equipos/ObtenerEquiposVista", function (data) {

                $.each(data, function (index, item) {
                    insertaEquipos(item);
                });
                
            })
                .fail(function () {
                    alert("error");
                })
                .always(function () {
                    $('#equipos-table').on('click', 'td input[type=checkbox]', function () {
                        var $row = $(this).closest('tr');
                        if ($row.is('.detail-row ')) return;
                        if (this.checked) $row.addClass(active_class);
                        else $row.removeClass(active_class);
                    });
                    $('.show-details-btn').on('click', function (e) {
                        e.preventDefault();
                        $(this).closest('tr').next().toggleClass('open');
                        $(this).find(ace.vars['.icon']).toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');
                    });
                });
        }

        function CargarFoto(files, dropped) {

            var archivo = files[0];

            if (typeof archivo === 'string') {
                //older browsers that don't support FileReader API, such as IE
                alert("Versión antigua de explorador y se soporta la funcionalidad, favor de actulizar versión");
                return false;
            } else if ('File' in window && archivo instanceof window.File) {
                //file is a "File" object with following properties
                var fd = new FormData();//empty FormData object
                fd.append('archivo', archivo);

                var deferred = $.ajax({
                    url: '@Url.Action("SubirFoto", "Equipos")',
                    type: 'POST',
                    processData: false,//important
                    contentType: false,//important
                    dataType: 'json',//depending on your server side response
                    data: fd
                });

                deferred.done(function (result) {
                    if (NombreArchivoFoto !== '') {
                        $.post('@Url.Action("ElimintarFoto", "Equipos")', { archivo: NombreArchivoFoto }).done(function (response) {
                            console.log('El archivo: ' + NombreArchivoFoto + ' es reemplazado por ' + result.foto + 'en el servidor');
                            NombreArchivoFoto = result.foto;
                        }).fail(function (error) {
                            console.log('El no se elimno el archivo: ' + NombreArchivoFoto + ' en el servidor');
                            NombreArchivoFoto = result.foto;
                        });
                    }
                    else {
                        console.log('Se cargo el archivo: ' + result.foto + ' en del servidor');
                        NombreArchivoFoto = result.foto;
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    alert('error al cargar el archivo')
                });
                return true;
            }
        }

        function ElimarFoto() {
            $.post('@Url.Action("ElimintarFoto", "Equipos")', { archivo: NombreArchivoFoto }).done(function (response) {
                console.log('Se elimino el archivo: ' + NombreArchivoFoto + ' del servidor');
                NombreArchivoFoto = '';
            });
            return true;
        }
    </script>
}